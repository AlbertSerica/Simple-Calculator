<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>Simple Calculator</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="app/css/bootstrap.min.css">
    
   


    <link rel="stylesheet" href="app/css/set_4.css">
    <style>
        html,
        body,
        #app {
            height: 100%;
            width: 100%;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }

        .el-row.panel {
            height: 25%;
        }

       .el-row {
            height: 15%;
        }
    </style>
    <script src="app/js/vue.js"></script>

    
    <!-- 引入样式 -->
<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-default/index.css">
<!-- 引入组件库 -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>

</head>

<body>
    <div id="app">
       <screen-panel></screen-panel>
        <el-row>
                <btn button-caption="CE"></btn>
                <btn button-caption="C"></btn>
                <btn button-caption="DELETE"></btn>
                <btn button-caption="/"></btn>
        </el-row>
        <el-row>
                <btn button-caption="7"></btn>
                <btn button-caption="8"></btn>
                <btn button-caption="9"></btn>
                <btn button-caption="*"></btn>
        </el-row>
        <el-row>
                <btn button-caption="4"></btn>
                <btn button-caption="5"></btn>
                <btn button-caption="6"></btn>
                <btn button-caption="-"></btn>
        </el-row>
        <el-row>
                <btn button-caption="1"></btn>
                <btn button-caption="2"></btn>
                <btn button-caption="3"></btn>
                <btn button-caption="+"></btn>
        </el-row>
        <el-row>
                <btn button-caption="+/-"></btn>
                <btn button-caption="0"></btn>
                <btn button-caption="."></btn>
                <btn button-caption="="></btn>
        </el-row>
    </div>
</body>
<script>
    var Event=new Vue();//事件绑定器，用于平行组件间通信
    Vue.component("btn",{
        props: ['buttonCaption'],
        template: `
            <div @click="btnOnClick" class="set_4_button4 raised hoverable" >
                <div class="anim"></div><span>{{buttonCaption}}</span>
            </div>`,
        data:function(){
            return{
                allowed:true
            }
        },
        methods:{
            btnOnClick:function(){
                if(this.allowed){
                    Event.$emit('pushKey',this.buttonCaption)//触发事件
                }
            }
        },
        mounted:function(){
            var me=this;
            Event.$on("setDotStatus",function(data){
                if(me.buttonCaption=='.'){
                    me.allowed=data;
                }
            })
        }
        
    })
    Vue.component("screen-panel",{
        template:`
        <el-row class="panel">
            <div style="height:50%;text-align:right">
               <div style="font-size:2em">
                 {{currentExpression}}
                </div>
            </div>
            <div style="height:50%;text-align:right;">
                <div style="font-size:5em;">
                    {{numberToPush}}
                </div>
             </div>
        </el-row>`,
        data:function(){
            return {
                currentExpression:'',
                numberToPush:'0',
                dotted:false,
                needToRefresh:false
            }
        },
        mounted:function(){
            var me=this;
            Event.$on("pushKey",function(data){//监听事件

                if(parseInt(data)||data=='0'){
                    if(me.needToRefresh){
                    me.numberToPush='';
                    
                    me.needToRefresh=false;
                    }
                    me.numberToPush=parseFloat(me.numberToPush+=data);
                }
                else if(data=="."){
               
                        me.numberToPush+=data;
                        Event.$emit("setDotStatus",false);
                  
                   
                }
                else if(data=="DELETE"){
                    me.numberToPush=me.numberToPush.slice(0,-1);
                    
                }
                else if (data=='C'){
                    me.currentExpression="";
                }
                else if(data=='CE'){
                    me.numberToPush="0";
                }
                else if(data=='+'||data=='-'||data=='*'||data=="/"){

                    if(me.numberToPush!=''){
                        console.log(me.numberToPush);
                        me.currentExpression+=me.numberToPush+data;
                        me.numberToPush='';
                        Event.$emit("setDotStatus",true);
                    }
                    else{
                        me.currentExpression=me.currentExpression.slice(0,-1)+data;
                    }
                }
                else if(data=='+/-'){
                    if(!me.switched){
                        me.numberToPush='-'+me.numberToPush;
                           
                    }
                    else{
                        me.numberToPush=me.numberToPush.slice(1);                       
                    }
                    me.switched=!me.switched;
                    me.numberToPush=parseFloat(me.numberToPush);
                }
                else if(data=='='){
                    me.currentExpression+=me.numberToPush;                  
                    me.numberToPush=eval('('+me.currentExpression+')');
                    me.needToRefresh=true;
                    console.log(me.numberToPush);
                    me.currentExpression='';

                    Event.$emit("setDotStatus",true);
                }
            })
        }
    })
    var app = new Vue({
        el: "#app",
        
    })
</script>

</html>